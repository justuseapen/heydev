# Ralph Progress Log
Started: Wed Jan 15 2026
---

## Codebase Patterns
- Production server container: `server-swockw8oo88ow0w0ocgc4ggw-013759300420`
- Database path in container: `/app/server/data/heydev.db`
- Database volume: `/var/lib/docker/volumes/swockw8oo88ow0w0ocgc4ggw_heydev-data/_data/heydev.db`
- drizzle-kit is not available in production container, must apply migrations manually with Node.js + better-sqlite3
- Auth endpoint is at `/api/auth/magic-link`, not `/api/auth/login`
- Session cookie name: `heydev_session`
- Health check endpoint: `GET /health` returns `{"status":"ok"}`
- To test authenticated flows: create session in DB, set `heydev_session` cookie in browser
- API keys are prefixed with `hd_live_` for production keys
- SSH to production: `ssh -i ~/.ssh/eapen-coolify.txt cloud@172.252.211.242`

---

## Wed Jan 15 2026 - US-005
- **What was implemented**: Verified setup wizard steps 2-4 work correctly
- **Files changed**: No code changes - verification testing only
- **Approach**:
  1. Used dev-browser skill to navigate through setup wizard steps
  2. Step 2: Verified "Install the Widget" heading, code snippet with API key pre-filled, Copy button works
  3. Step 3: Verified "Get Notified" heading with "Optional" subtext, Email/Webhook toggle cards, Skip for now link
  4. Step 4: Verified "Test Your Integration" heading, URL input field, "Open Test Page" button, "Skip test" link
  5. Had to reset test user's setup_completed_at to NULL to test step 4 (was already set from US-004)
  6. Clicking "Skip test" navigates to /inbox and sets setup_completed_at timestamp
  7. After page reload, header shows: Inbox, Settings, Log out (full navigation)
- **Learnings for future iterations:**
  - SetupPage renders wizard when `user.setupCompletedAt === null`, Settings view when completed
  - Layout component shows different nav based on setupCompletedAt: during setup only "Log out", after setup shows "Inbox, Settings, Log out"
  - To re-test wizard after completion, reset user's setup_completed_at to NULL in database
  - Session cookie may cache old user data; page reload needed to see updated nav after setup completion
---

## Wed Jan 15 2026 - US-006
- **What was implemented**: Verified returning user flow (users who completed setup)
- **Files changed**: No code changes - verification testing only
- **Approach**:
  1. Found user 1 (test@example.com) in production DB with setup_completed_at set
  2. Created session for user 1 by inserting into sessions table
  3. Used dev-browser to set heydev_session cookie and navigate to /inbox
  4. Verified /inbox loads correctly with full nav: Inbox, Settings, Log out
  5. Clicked Settings link - navigates to /setup which shows Settings view (not wizard)
  6. Settings page displays: API Key section (with masked key), Widget snippet, Notification Channels (Slack)
- **Learnings for future iterations:**
  - Sessions table schema: id, session_id (not token), user_id, expires_at, created_at
  - expires_at and created_at are TEXT (ISO strings), not INTEGER timestamps
  - To create test session: INSERT INTO sessions (session_id, user_id, expires_at, created_at) VALUES (?, ?, ?, ?)
  - Landing page (/) is public and doesn't redirect authenticated users - must navigate directly to /inbox
---

## Previous Run Summary (Onboarding Overhaul)
- Successfully deployed SetupWizard with 4 steps
- Database migration 0003 applied (setup_step, setup_completed_at columns)
- Login and landing pages verified working
- Setup wizard step 1 (API key generation) verified working
- Blocking issue: Resend domain (heydev.io) not verified - emails fail with 403

---

