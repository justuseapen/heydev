# Ralph Progress Log
Started: Tue Jan 14 2026
Feature: Phase 2 - Feedback Inbox & Landing Page
---

## Codebase Patterns
- Database schema in `server/src/db/schema.ts` uses Drizzle ORM with SQLite
- Use `text("column", { enum: enumArray })` for enum columns with `notNull().default("value")` for defaults
- Use `integer("column")` for nullable timestamp columns (null = not set)
- Export type constants like `conversationStatuses` as const arrays for type safety
- Session auth: use `getCookie(c, 'heydev_session')` then lookup session/user (pattern in keys.ts, feedbackApi.ts)
- Session-auth routes mount directly on app; API-key-auth routes mount under `api` Hono instance
- Use `sql<number>\`count(*)\`` template for aggregations in Drizzle
---

## 2026-01-14 - US-001
- What was implemented: Added status, readAt, and archivedAt columns to conversations table
- Files changed: server/src/db/schema.ts
- **Learnings for future iterations:**
  - Schema uses Drizzle ORM patterns - follow existing conventions
  - Timestamps are stored as integers for readAt/archivedAt (Unix timestamps)
  - Status uses text with enum constraint for type safety
  - Added ConversationStatus type export for use in other files
---

## 2026-01-14 - US-002
- What was implemented: GET /api/feedback endpoint for listing conversations
- Files changed: server/src/routes/feedbackApi.ts, server/src/index.ts
- **Learnings for future iterations:**
  - Session auth pattern: use `getCookie(c, 'heydev_session')` then lookup session/user
  - Session-auth routes are mounted directly on app, API-key-auth routes mount under `api` Hono instance
  - Use `sql<number>\`count(*)\`` template for aggregations in Drizzle
  - Query params accessed via `c.req.query('param')` in Hono
  - For listing with filters, build conditions array and use `and(...conditions)`
---

## 2026-01-14 - US-003
- What was implemented: GET /api/feedback/:conversationId endpoint for conversation detail
- Files changed: server/src/routes/feedbackApi.ts
- **Learnings for future iterations:**
  - Route params accessed via `c.req.param('paramName')` in Hono
  - Inbound message content is JSON with text, screenshot_url, audio_url, context fields
  - Outbound message content is plain text (the reply message)
  - Use `asc(column)` for ascending sort order in Drizzle
  - Extract context from first inbound message for conversation metadata
---
