# Ralph Progress Log
Started: Tue Jan 14 2026
Feature: Phase 2 - Feedback Inbox & Landing Page
---

## Codebase Patterns
- Database schema in `server/src/db/schema.ts` uses Drizzle ORM with SQLite
- Use `text("column", { enum: enumArray })` for enum columns with `notNull().default("value")` for defaults
- Use `integer("column")` for nullable timestamp columns (null = not set)
- Export type constants like `conversationStatuses` as const arrays for type safety
- Session auth: use `getCookie(c, 'heydev_session')` then lookup session/user (pattern in keys.ts, feedbackApi.ts)
- Session-auth routes mount directly on app; API-key-auth routes mount under `api` Hono instance
- Use `sql<number>\`count(*)\`` template for aggregations in Drizzle
- In Hono, static routes (e.g., /unread-count) must be defined BEFORE parameterized routes (e.g., /:id)
---

## 2026-01-14 - US-001
- What was implemented: Added status, readAt, and archivedAt columns to conversations table
- Files changed: server/src/db/schema.ts
- **Learnings for future iterations:**
  - Schema uses Drizzle ORM patterns - follow existing conventions
  - Timestamps are stored as integers for readAt/archivedAt (Unix timestamps)
  - Status uses text with enum constraint for type safety
  - Added ConversationStatus type export for use in other files
---

## 2026-01-14 - US-002
- What was implemented: GET /api/feedback endpoint for listing conversations
- Files changed: server/src/routes/feedbackApi.ts, server/src/index.ts
- **Learnings for future iterations:**
  - Session auth pattern: use `getCookie(c, 'heydev_session')` then lookup session/user
  - Session-auth routes are mounted directly on app, API-key-auth routes mount under `api` Hono instance
  - Use `sql<number>\`count(*)\`` template for aggregations in Drizzle
  - Query params accessed via `c.req.query('param')` in Hono
  - For listing with filters, build conditions array and use `and(...conditions)`
---

## 2026-01-14 - US-003
- What was implemented: GET /api/feedback/:conversationId endpoint for conversation detail
- Files changed: server/src/routes/feedbackApi.ts
- **Learnings for future iterations:**
  - Route params accessed via `c.req.param('paramName')` in Hono
  - Inbound message content is JSON with text, screenshot_url, audio_url, context fields
  - Outbound message content is plain text (the reply message)
  - Use `asc(column)` for ascending sort order in Drizzle
  - Extract context from first inbound message for conversation metadata
---

## 2026-01-14 - US-004, US-005, US-006
- What was implemented: Conversation status management endpoints
  - PATCH /:conversationId/read - marks as read
  - PATCH /:conversationId/status - updates status (new/resolved)
  - PATCH /:conversationId/archive - archives
  - PATCH /:conversationId/unarchive - unarchives
- Files changed: server/src/routes/feedbackApi.ts
- **Learnings for future iterations:**
  - Use `.update().set().where().returning()` for updates with Drizzle
  - Timestamps stored as Unix seconds: `Math.floor(Date.now() / 1000)`
  - Parse JSON body with `c.req.json<TypeHint>()` in Hono
  - Created helper `getConversationForUser()` to DRY up ownership checks
---

## 2026-01-14 - US-007
- What was implemented: GET /api/feedback/unread-count endpoint
- Files changed: server/src/routes/feedbackApi.ts
- **Learnings for future iterations:**
  - Static routes (like /unread-count) must be defined BEFORE parameterized routes (like /:conversationId) in Hono
  - Use `and()` with multiple `isNull()` conditions for compound WHERE clauses
---

## 2026-01-14 - US-008
- What was implemented: LandingPage.tsx hero section component
- Files changed: dashboard/src/pages/LandingPage.tsx
- **Learnings for future iterations:**
  - Dashboard uses TailwindCSS for styling
  - Pages go in dashboard/src/pages/, components in dashboard/src/components/
  - Use `document.getElementById()` and `scrollIntoView({ behavior: 'smooth' })` for scroll-to-section
  - Vintage-inspired design uses Georgia serif for headings, system fonts elsewhere
---

## 2026-01-14 - US-009
- What was implemented: Features section with 4 feature cards
- Files changed: dashboard/src/pages/LandingPage.tsx
- **Learnings for future iterations:**
  - Use HTML entities for unicode emojis (e.g., `&#127908;` for microphone)
  - Tailwind responsive: `grid-cols-1 md:grid-cols-2` for 1 col mobile, 2 col desktop
---

## 2026-01-14 - US-010
- What was implemented: Installation snippet with syntax highlighting and copy button
- Files changed: dashboard/src/pages/LandingPage.tsx
- **Learnings for future iterations:**
  - Use `navigator.clipboard.writeText()` for clipboard, with `document.execCommand('copy')` fallback
  - Inline syntax highlighting: use `<span style={{ color: '...' }}>` for code tokens
  - Use useState for temporary UI state like "Copied!" feedback
---
